# Consultant 系統分層架構設計

## 職責分配體系

Consultant 系統的分層架構遵循經典的三層架構模式,但在實踐中進行了領域驅動設計的強化。表現層(Controller)承擔請求路由與參數校驗職責,共計86個REST控制器覆蓋了顧問管理的各個業務場景。業務層(Service)封裝了核心業務邏輯,98個服務類對應著不同的業務能力單元,如顧問招聘(ConsultantApplyResource)、薪資核算(ConsultantPerformanceResource)、課程評價(ConsultantEvaluationResource)等。數據訪問層(Repository)負責持久化操作,109個Repository接口通過MyBatis映射器實現對MySQL與SQL Server的統一訪問。

值得關注的是Domain層的設計,該層包含229個領域模型類,這一數量遠超其他層級。這種設計體現了富領域模型的思想:領域對象不僅承載數據,更封裝了業務規則與行為。例如,顧問實體(Consultant)不僅包含基本信息,還內聚了狀態轉換邏輯、資格驗證規則等業務約束。這種面向對象的建模方式使得業務邏輯更貼近真實世界的概念,降低了業務與技術的阻抗不匹配。

## 數據流向與約束

系統中的數據流動遵循嚴格的單向依賴原則:Controller依賴Service,Service依賴Repository,Repository依賴Domain。這一設計確保了上層對下層的依賴始終是通過接口抽象進行的,而非具體實現。在請求處理流程中,數據經歷了多次形態轉化:HTTP請求首先被解析為請求參數對象(Param),隨後在Service層轉換為領域模型(Domain),最終在Repository層映射為數據庫實體。這種數據對象的層次化轉換雖然增加了編碼工作量,但有效隔離了層間的耦合,使得任一層的變更不會波及其他層。

在數據流向的約束機制上,系統通過Converter組件實現了顯式的對象轉換。每當數據跨越層級邊界時,都會經過相應的轉換器處理,確保數據結構符合目標層的契約要求。例如,DTO與Domain之間的轉換由專門的Converter類負責,這種責任的明確分配避免了在各處散落轉換邏輯,提升了代碼的可維護性。

## 邊界隔離策略

Consultant系統通過多重機制實現了層間邊界的有效隔離。首先,在編譯層面,通過Maven模塊的依賴管理確保了api模塊與service模塊的清晰分界:api模塊只包含接口定義與DTO,不包含任何實現邏輯,其他微服務通過依賴api模塊即可實現遠程調用,而無法直接訪問service模塊的實現細節。這種物理隔離從根本上杜絕了跨層直接調用的可能性。

其次,在運行時層面,Spring的依賴注入機制確保了組件之間始終通過接口協作。Controller通過@Resource注解注入Service接口,Service通過@Autowired注入Repository接口,這種面向接口編程的實踐使得具體實現可以在測試或運維場景中被輕易替換,極大地提升了系統的可測試性與靈活性。

再者,在數據結構層面,不同層次使用不同的數據對象定義進一步強化了隔離。Controller層使用輕量級的DTO(如ConBriefDTO、ConBasicInfoDto),Service層操作富含業務邏輯的Domain對象(如Consultant實體),Repository層則直接映射數據庫表結構。這種數據對象的層次化設計確保了下層實現細節(如數據庫字段名、存儲格式)不會泄露到上層,使得數據庫重構或遷移不會影響業務邏輯層。

## 異常處理流

系統在分層架構中實現了結構化的異常處理流。Repository層在遇到數據訪問異常時,會將底層的SQLExcep轉化為業務相關的DataAccessException,確保業務層不會感知到具體的數據庫異常細節。Service層則進一步將異常封裝為業務異常(如ConsultantNotFoundException),這些異常攜帶了業務語義,使得上層能夠理解錯誤的業務含義而非技術細節。

在Controller層,通過統一的異常處理器(基於@ControllerAdvice)實現了異常到HTTP響應的轉換。不同類型的業務異常被映射為相應的HTTP狀態碼與錯誤信息,確保了API響應的一致性與可預測性。這種分層的異常處理策略使得異常信息在向上傳播的過程中,從技術細節逐步抽象為業務語義,最終以用戶友好的形式呈現,體現了關注點分離與責任分明的設計原則。

## 架構優勢與局限性

這種嚴格的分層架構為Consultant系統帶來了顯著的工程優勢。各層職責清晰、邊界明確,使得團隊成員可以並行開發而不產生衝突。層間通過接口協作的機制確保了單元測試的可實施性:每一層都可以通過Mock依賴進行獨立測試。數據對象的層次化設計使得技術棧遷移(如從MyBatis遷移到JPA)不會影響業務邏輯層,為系統的長期演進提供了保障。

然而,這種設計也並非毫無代價。數據對象的多次轉換增加了編碼工作量與運行時開銷,對於簡單的CRUD操作可能顯得過於繁重。此外,層級的增加也延長了請求處理的調用鏈,在極端性能敏感的場景下可能成為瓶頸。因此,這種架構更適合業務邏輯複雜、團隊規模較大、長期演進需求明確的企業級系統,而對於原型驗證或短期項目可能並非最優選擇。綜合來看,Consultant系統的分層設計與其業務複雜度及團隊協作需求高度契合,體現了架構決策的權衡藝術。
